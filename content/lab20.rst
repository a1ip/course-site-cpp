Пересылка сообщений и вычисление площади методом Монте-Карло
##############################################################################

:date: 2017-03-16 09:00


.. default-role:: code
.. contents:: Содержание

Прием и отправка сообщений в MPI
================================

Процессы между собой контактируют с помощью сообщений. Они бывают блокирующие и неблокирующие и передаются через буфер. Подробнее о синтаксисе и принципах передачи сообщений в следующей презентации__.

.. __: {filename}/extra/P2P.pdf
 

Упражнение 1 (пересылка массивов)
---------------------------------

Реализовать программу на MPI, осуществляющую пересылку массива данных от одного процесса к другому.
Процесс с номером 0 создает массив данных типа int размера 10 и заполняет его последовательно числами от 0 до 9.
Затем процесс с номером 0 отсылает массив с данными процессу с номером 1.
После получения данных процесс с номером 1 выводит полученный массив на экран.
Пересылку осуществлять путем одного взаимодействия типа точка-точка.
Результатом работы программы должен быть вывод массива на экран.
Параллельная версия должна работать в любое число потоков.

Пример работы:

.. code-block:: c

	mpirun -np 5 ./sendrecv
	0 1 2 3 4 5 6 7 8 9



Описание метода Монте-Карло
===========================

Поместим фигуру, площадь которой нужно вычислить в прямоугольник минимального размера. Будем случайным образом расставлять точки внутри этого прямоугольника. Естественно предположить, что чем больше площадь фигуры, тем чаще в нее будут попадать точки и следовательно при большом числе точек, наугад выбранных внутри прямоугольника, доля точек, содержащихся в искомой фигуре, приближенно равна отношению площади фигуры к площади квадрата.

Исходными данными являются стороны прямоугольника a и b, содержащего фигуру, и количество точек N, которое будет случайным образом выбирано внутри прямоугольника. Результатом является площадь S фигуры. Если через n обозначить число тех наугад выбранных точек, которые содержаться в фигуре, то площадь S приближенно равна S=(n/N)*a*b:


.. image:: {filename}/images/lab20/lab20_img1.png
   :align: center


Распараллеливание метода
========================

Для начала рассмотрим последовательную реализацию метода:

.. image:: {filename}/images/lab20/lab20_img2.png
   :align: center
   :width: 630 px

Поскольку каждая итерация является независимой относительно остальных, очевидно, алгоритм легко можно распараллелить несколькими путями:
* Каждый процесс самостоятельно считает площадь фигуры методом Монте-Карло и в конце берется среднее арифметическое:

.. image:: {filename}/images/lab20/lab20_img3.png
   :width: 630 px
   :align: center

* Расчетная область делится на кол-во областей, равных количеству процессов, и каждый производит расчет в своей области. Далее полученные результаты суммируются:

.. image:: {filename}/images/lab20/lab20_img4.png
   :width: 630 px
   :align: center




Вычисление числа :math:`\pi`
============================

Применим эту модель для приближенного вычисления числа :math:`\pi` путем нахождения площади круга радиуса R=1. Формула площади круга известна:

.. math::
	S = \pi*R


при R=1 площадь S численно равна :math:`\pi`. Квадрат для такого круга получается со стороной а=2. Площадь квадрата равна 4. Тогда площадь фигуры будет равна:

.. math::
	S = (n/N)*4

что можно заменить на

.. math::
	\pi = (n/N)*4.

Выберем за центр окружности и квадрата начало системы координат, тогда выбрать точку - это значит задать ее координаты: для числа X и Y. Точка принадлежит квадрату, если -1<=X<=1 и -1<=Y<=1. Если X*X+Y*Y<=1, то точка попадает в круг, иначе она лежит вне круга. Это и есть математическое соотношение, позволяющее для каждой точки определять, лежит ли она внутри фигуры. 
Математическая модель, выбранная нами для нахождения площади используе случайные числа (такие модели называют вероятностными). В связи с чем при запуске программы для одного и того же количества случайных чисел результаты будут разными. Можно ли доверять результатам вычислений? На этот вопрос отвечает специальный раздел математики - теория вероятностей, в котором имеется строгое математическое доказательство метода Монте-Карло. На самом деле точность результатов зависит не только от того, является модель вероятностной или нет, - это зависит и от точности исходных данных, точности вычислений и в сильной мере от качества генератора случайных чисел.

Оценка достоверности полученного результата производится сравнением двух результатов вычислений, один из которых выполнен с заведомо большей точностью, чем другой. Очевидно, с увеличением количества случайных точек будет расти точность. А случае если используется программный генератор псевдослучайных чисел не очень хорошего качества, точность может перестать расти с увеличением крличества точек.


Упражнение 2
============

#. Реализуйте вычисление числа :math:`\pi` последовательным методом.
#. Реализуйте вычисление числа :math:`\pi` параллельным методом, когда каждый процесс ставит точки во всей области расчета.
#. Реализуйте вычисление числа :math:`\pi` параллельным методом, когда каждый процесс ставит точки в своей области расчета.
